<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NestJS äº”ç§æ•°æ®ä¼ è¾“æ–¹å¼æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qs/dist/qs.min.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-right: 440px;
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .method-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #fafafa;
      }
      .method-title {
        color: #e74c3c;
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .method-description {
        color: #666;
        margin-bottom: 15px;
        font-style: italic;
      }
      button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 10px;
        margin-bottom: 10px;
      }
      button:hover {
        background-color: #2980b9;
      }
      .file-input {
        margin: 10px 0;
      }
      .result {
        background-color: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        max-height: 300px;
        overflow-y: auto;
        position: fixed;
        top: 20px;
        right: 20px;
        width: 400px;
        z-index: 1000;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        border: 2px solid #34495e;
      }
      .clear-btn {
        background-color: #e74c3c;
      }
      .clear-btn:hover {
        background-color: #c0392b;
      }
      .info-btn {
        background-color: #27ae60;
      }
      .info-btn:hover {
        background-color: #229954;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš€ NestJS äº”ç§æ•°æ®ä¼ è¾“æ–¹å¼æµ‹è¯•</h1>

      <!-- è·å–ä¼ è¾“æ–¹å¼è¯´æ˜ -->
      <div class="method-section">
        <div class="method-title">ğŸ“š ä¼ è¾“æ–¹å¼è¯´æ˜</div>
        <div class="method-description">è·å–æ‰€æœ‰æ•°æ®ä¼ è¾“æ–¹å¼çš„è¯¦ç»†è¯´æ˜</div>
        <button class="info-btn" onclick="getTransferMethods()">
          è·å–ä¼ è¾“æ–¹å¼è¯´æ˜
        </button>
      </div>

      <!-- 1. URL å‚æ•° -->
      <div class="method-section">
        <div class="method-title">1. URL å‚æ•°ä¼ è¾“</div>
        <div class="method-description">
          é€šè¿‡ URL è·¯å¾„ä¼ é€’å‚æ•°ï¼Œå¦‚ /api/person/123
        </div>
        <button onclick="testUrlParam()">æµ‹è¯• URL å‚æ•°</button>
      </div>

      <!-- 2. æŸ¥è¯¢å‚æ•° -->
      <div class="method-section">
        <div class="method-title">2. æŸ¥è¯¢å‚æ•°ä¼ è¾“ (Query String)</div>
        <div class="method-description">
          é€šè¿‡ URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’å‚æ•°ï¼Œå¦‚ ?name=å¼ ä¸‰&age=25
        </div>
        <button onclick="testQueryString()">æµ‹è¯•æŸ¥è¯¢å‚æ•°</button>
      </div>

      <!-- 3. Form-urlencoded -->
      <div class="method-section">
        <div class="method-title">3. Form-urlencoded ä¼ è¾“</div>
        <div class="method-description">
          é€šè¿‡è¯·æ±‚ä½“ä¼ é€’è¡¨å•ç¼–ç æ•°æ® (application/x-www-form-urlencoded)
        </div>
        <button onclick="testFormUrlEncoded()">æµ‹è¯• Form-urlencoded</button>
      </div>

      <!-- 4. JSON -->
      <div class="method-section">
        <div class="method-title">4. JSON æ•°æ®ä¼ è¾“</div>
        <div class="method-description">
          é€šè¿‡è¯·æ±‚ä½“ä¼ é€’ JSON æ ¼å¼æ•°æ® (application/json)
        </div>
        <button onclick="testJson()">æµ‹è¯• JSON æ•°æ®</button>
      </div>

      <!-- 5. Form-data -->
      <div class="method-section">
        <div class="method-title">5. Form-data ä¼ è¾“ (æ–‡ä»¶ä¸Šä¼ )</div>
        <div class="method-description">
          é€šè¿‡ multipart/form-data ä¼ é€’æ•°æ®å’Œæ–‡ä»¶
        </div>
        <div class="file-input">
          <input type="file" id="fileInput" multiple accept="*/*" />
        </div>
        <button onclick="testFormData()">æµ‹è¯• Form-data (æ–‡ä»¶ä¸Šä¼ )</button>
      </div>

      <!-- æ§åˆ¶æŒ‰é’® -->
      <div class="method-section">
        <button class="clear-btn" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
      </div>
    </div>

    <!-- å›ºå®šå®šä½çš„ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
    <div id="result" class="result">
      ç‚¹å‡»å·¦ä¾§æŒ‰é’®å¼€å§‹æµ‹è¯•... ğŸ’¡ æç¤ºï¼š - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network
      æ ‡ç­¾é¡µå¯ä»¥æŸ¥çœ‹è¯·æ±‚è¯¦æƒ… - æ¯ç§ä¼ è¾“æ–¹å¼éƒ½æœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œç‰¹ç‚¹ -
      æ–‡ä»¶ä¸Šä¼ éœ€è¦é€‰æ‹©æ–‡ä»¶åå†ç‚¹å‡»æµ‹è¯•æŒ‰é’®
    </div>

    <script>
      // ç»“æœæ˜¾ç¤ºå‡½æ•°
      function displayResult(title, data) {
        const resultDiv = document.getElementById('result');
        const timestamp = new Date().toLocaleTimeString();
        resultDiv.textContent += `\n\n[${timestamp}] ${title}:\n${JSON.stringify(data, null, 2)}`;
        resultDiv.scrollTop = resultDiv.scrollHeight;
      }

      // é”™è¯¯æ˜¾ç¤ºå‡½æ•°
      function displayError(title, error) {
        const resultDiv = document.getElementById('result');
        const timestamp = new Date().toLocaleTimeString();
        resultDiv.textContent += `\n\n[${timestamp}] âŒ ${title} é”™è¯¯:\n${error.response ? JSON.stringify(error.response.data, null, 2) : error.message}`;
        resultDiv.scrollTop = resultDiv.scrollHeight;
      }

      // æ¸…ç©ºç»“æœ
      function clearResults() {
        document.getElementById('result').textContent =
          'ç»“æœå·²æ¸…ç©ºï¼Œç‚¹å‡»å·¦ä¾§æŒ‰é’®å¼€å§‹æµ‹è¯•...';
      }

      // è·å–ä¼ è¾“æ–¹å¼è¯´æ˜
      async function getTransferMethods() {
        try {
          const response = await axios.get('/api/person/info/methods');
          displayResult('ğŸ“š ä¼ è¾“æ–¹å¼è¯´æ˜', response.data);
        } catch (error) {
          displayError('è·å–ä¼ è¾“æ–¹å¼è¯´æ˜', error);
        }
      }

      // 1. æµ‹è¯• URL å‚æ•°
      async function testUrlParam() {
        try {
          const userId = '12345';
          const response = await axios.get(`/api/person/${userId}`);
          displayResult('ğŸ”— URL å‚æ•°æµ‹è¯•', response.data);
        } catch (error) {
          displayError('URL å‚æ•°æµ‹è¯•', error);
        }
      }

      // 2. æµ‹è¯•æŸ¥è¯¢å‚æ•°
      async function testQueryString() {
        try {
          const response = await axios.get('/api/person', {
            params: {
              name: 'å¼ ä¸‰',
              age: 28,
            },
          });
          displayResult('â“ æŸ¥è¯¢å‚æ•°æµ‹è¯•', response.data);
        } catch (error) {
          displayError('æŸ¥è¯¢å‚æ•°æµ‹è¯•', error);
        }
      }

      // 3. æµ‹è¯• Form-urlencoded
      async function testFormUrlEncoded() {
        try {
          const data = { name: 'æå››', age: 25 };
          const response = await axios.post('/api/person', Qs.stringify(data), {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          });
          displayResult('ğŸ“ Form-urlencoded æµ‹è¯•', response.data);
        } catch (error) {
          displayError('Form-urlencoded æµ‹è¯•', error);
        }
      }

      // 4. æµ‹è¯• JSON
      async function testJson() {
        try {
          const data = { name: 'ç‹äº”', age: 30 };
          const response = await axios.post('/api/person', data);
          displayResult('ğŸ“„ JSON æ•°æ®æµ‹è¯•', response.data);
        } catch (error) {
          displayError('JSON æ•°æ®æµ‹è¯•', error);
        }
      }

      // 5. æµ‹è¯• Form-data
      async function testFormData() {
        try {
          const fileInput = document.querySelector('#fileInput');
          const formData = new FormData();

          formData.append('name', 'èµµå…­');
          formData.append('age', '35');

          if (fileInput.files.length > 0) {
            for (let i = 0; i < fileInput.files.length; i++) {
              formData.append(`files`, fileInput.files[i]);
            }
          } else {
            displayResult('ğŸ“ Form-data æµ‹è¯•', {
              message: 'æœªé€‰æ‹©æ–‡ä»¶ï¼Œä»…æµ‹è¯•æ–‡æœ¬æ•°æ®ä¼ è¾“',
            });
          }

          const response = await axios.post('/api/person/file', formData, {
            headers: {
              'Content-Type': 'multipart/form-data',
            },
          });
          displayResult('ğŸ“ Form-data æµ‹è¯•', response.data);
        } catch (error) {
          displayError('Form-data æµ‹è¯•', error);
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function () {
        console.log('ğŸš€ NestJS äº”ç§æ•°æ®ä¼ è¾“æ–¹å¼æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ’¡ æç¤ºï¼šæ‰“å¼€ Network æ ‡ç­¾é¡µæŸ¥çœ‹è¯·æ±‚è¯¦æƒ…');
      });
    </script>
  </body>
</html>
