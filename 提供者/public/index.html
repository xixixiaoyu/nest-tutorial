<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NestJS æä¾›è€… (Provider) æ•™å­¦</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: #2d3748;
            color: white;
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar h2 {
            color: #63b3ed;
            margin-bottom: 20px;
            font-size: 1.2em;
            border-bottom: 2px solid #4a5568;
            padding-bottom: 10px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 8px;
        }

        .sidebar a {
            color: #e2e8f0;
            text-decoration: none;
            display: block;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 0.9em;
        }

        .sidebar a:hover {
            background: #4a5568;
            color: #63b3ed;
        }

        .sidebar .level-2 {
            padding-left: 20px;
            font-size: 0.85em;
        }

        .sidebar .level-3 {
            padding-left: 35px;
            font-size: 0.8em;
            color: #a0aec0;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
            max-width: calc(100vw - 280px);
        }

        .content-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            color: #2d3748;
            font-size: 1.8em;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #63b3ed;
        }

        h3 {
            color: #4a5568;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
            padding-left: 15px;
            border-left: 4px solid #63b3ed;
        }

        h4 {
            color: #718096;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 16px;
            text-align: justify;
            color: #4a5568;
        }

        .intro-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.7;
        }

        .highlight-box {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-left: 4px solid #38b2ac;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-box {
            background: #fffaf0;
            border: 1px solid #fbd38d;
            border-left: 4px solid #ed8936;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        ul {
            margin: 16px 0;
            padding-left: 30px;
        }

        li {
            margin-bottom: 8px;
            color: #4a5568;
        }

        pre {
            background: #2d3748 !important;
            border-radius: 8px;
            padding: 20px !important;
            margin: 20px 0 !important;
            overflow-x: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        code {
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }

        .inline-code {
            background: #edf2f7;
            color: #e53e3e;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #4a5568;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f7fafc;
        }

        .scroll-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #63b3ed;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(99, 179, 237, 0.3);
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
        }

        .scroll-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .scroll-top:hover {
            background: #4299e1;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 1000;
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px;
                max-width: 100vw;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h2>ğŸ“š è¯¾ç¨‹å¤§çº²</h2>
            <ul>
                <li><a href="#intro">ğŸ  ä»€ä¹ˆæ˜¯æä¾›è€…ï¼Ÿ</a></li>
                <li><a href="#create-service">ğŸ± åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæœåŠ¡</a></li>
                <li><a href="#use-service">ğŸ¯ åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨æœåŠ¡</a></li>
                <li><a href="#register-provider">ğŸ“ æ³¨å†Œæä¾›è€…</a></li>
                <li><a href="#async-provider">âš¡ å¼‚æ­¥æä¾›è€…</a></li>
                <li><a href="#advanced">ğŸš€ æä¾›è€…çš„è¿›é˜¶ç©æ³•</a>
                    <ul>
                        <li><a href="#scope" class="level-2">ğŸ”„ ä½œç”¨åŸŸ</a>
                            <ul>
                                <li><a href="#default-scope" class="level-3">DEFAULT å•ä¾‹</a></li>
                                <li><a href="#request-scope" class="level-3">REQUEST è¯·æ±‚ä½œç”¨åŸŸ</a></li>
                                <li><a href="#transient-scope" class="level-3">TRANSIENT ç¬æ€ä½œç”¨åŸŸ</a></li>
                            </ul>
                        </li>
                        <li><a href="#optional-deps" class="level-2">â“ å¯é€‰ä¾èµ–</a></li>
                        <li><a href="#property-injection" class="level-2">ğŸ·ï¸ å±æ€§æ³¨å…¥</a></li>
                        <li><a href="#manual-instance" class="level-2">ğŸ”§ æ‰‹åŠ¨è·å–å®ä¾‹</a></li>
                        <li><a href="#custom-providers" class="level-2">âš™ï¸ è‡ªå®šä¹‰æä¾›è€…</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="content-section">
                <h1>NestJS æä¾›è€… (Provider) å®Œå…¨æŒ‡å—</h1>
                <div class="intro-box">
                    åœ¨ Nest çš„ä¸–ç•Œé‡Œï¼Œæä¾›è€…ï¼ˆProviderï¼‰å°±åƒæ˜¯åº”ç”¨ç¨‹åºçš„"ä¸“ä¸šå·¥åŒ "ã€‚
                    å¦‚æœæŠŠåº”ç”¨æ¯”ä½œä¸€åº§æˆ¿å­ï¼Œé‚£ä¹ˆæä¾›è€…å°±æ˜¯ç”µå·¥ã€æœ¨åŒ ã€æ°´ç®¡å·¥è¿™äº›å„å¸å…¶èŒçš„ä¸“ä¸šäººå£«ã€‚
                    æ¯ä¸ªæä¾›è€…éƒ½æœ‰è‡ªå·±çš„ä¸“é•¿ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼ä¸ºåº”ç”¨æä¾›æœåŠ¡ã€‚
                </div>
            </div>

            <div class="content-section" id="intro">
                <h2>ä»€ä¹ˆæ˜¯æä¾›è€…ï¼Ÿ</h2>
                <p>æä¾›è€…æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥è¢«æ³¨å…¥åˆ°å…¶ä»–ç±»ä¸­çš„ç±»ã€‚å®ƒä»¬æ‰¿æ‹…ç€ä¸åŒçš„èŒè´£ï¼š</p>
                <ul>
                    <li><strong>æœåŠ¡ï¼ˆServiceï¼‰</strong>ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®æ“ä½œ</li>
                    <li><strong>ä»“åº“ï¼ˆRepositoryï¼‰</strong>ï¼šä¸“é—¨è´Ÿè´£ä¸æ•°æ®åº“æ‰“äº¤é“</li>
                    <li><strong>å·¥å‚ï¼ˆFactoryï¼‰</strong>ï¼šè´Ÿè´£åˆ›å»ºå¤æ‚å¯¹è±¡</li>
                    <li><strong>è¾…åŠ©ç±»ï¼ˆHelperï¼‰</strong>ï¼šæä¾›å„ç§é€šç”¨åŠŸèƒ½</li>
                </ul>
                <div class="highlight-box">
                    <p><strong>ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong> æä¾›è€…æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰çš„æ–¹å¼è¢«"é€è¾¾"åˆ°éœ€è¦å®ƒä»¬çš„åœ°æ–¹ï¼Œè¿™è®©ä»£ç å˜å¾—æ›´åŠ æ¨¡å—åŒ–å’Œå¯æµ‹è¯•ã€‚</p>
                </div>
            </div>

            <div class="content-section" id="create-service">
                <h2>åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæœåŠ¡ (Service)</h2>
                <p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®¡ç†çŒ«å’ªä¿¡æ¯çš„ä¾‹å­æ¥äº†è§£å¦‚ä½•åˆ›å»ºæœåŠ¡ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ª CatsService æ¥å¤„ç†æ‰€æœ‰å…³äºçŒ«å’ªçš„æ“ä½œï¼š</p>
                
<pre><code class="language-typescript">import { Injectable } from '@nestjs/common';
import { Cat } from './interfaces/cat.interface';

@Injectable() // è¿™ä¸ªè£…é¥°å™¨æ˜¯å…³é”®
export class CatsService {
  private readonly cats: Cat[] = []; // ç”¨æ•°ç»„æ¨¡æ‹Ÿæ•°æ®åº“

  create(cat: Cat) {
    this.cats.push(cat);
    console.log('ä¸€åªæ–°çŒ«å’ªåŠ å…¥äº†ï¼ç°åœ¨æœ‰', this.cats.length, 'åªçŒ«å’ªã€‚');
  }

  findAll(): Cat[] {
    console.log('æ­£åœ¨æŸ¥æ‰¾æ‰€æœ‰çŒ«å’ª...');
    return this.cats;
  }
}</code></pre>

                <div class="highlight-box">
                    <p><strong>ğŸ”‘ å…³é”®ç‚¹ï¼š</strong> <code class="inline-code">@Injectable()</code> è£…é¥°å™¨ç›¸å½“äºå‘Šè¯‰ Nestï¼šCatsService è¿™ä¸ªç±»æ˜¯ä¸ªæä¾›è€…ï¼Œä½ å¯ä»¥ç®¡ç†å®ƒï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒ'æ³¨å…¥'ç»™åˆ«äººç”¨ã€‚</p>
                </div>
            </div>

            <div class="content-section" id="use-service">
                <h2>åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨æœåŠ¡</h2>
                <p>ç°åœ¨æˆ‘ä»¬æœ‰äº† CatsServiceï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨å®ƒï¼š</p>

<pre><code class="language-typescript">import { Controller, Get, Post, Body } from '@nestjs/common';
import { CreateCatDto } from './dto/create-cat.dto';
import { CatsService } from './cats.service';
import { Cat } from './interfaces/cat.interface';

@Controller('cats')
export class CatsController {
  // é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ CatsService
  constructor(private readonly catsService: CatsService) {}

  @Post()
  async create(@Body() createCatDto: CreateCatDto) {
    this.catsService.create(createCatDto);
    return 'æˆåŠŸæ·»åŠ äº†ä¸€åªçŒ«å’ªï¼';
  }

  @Get()
  async findAll(): Promise<Cat[]> {
    return this.catsService.findAll();
  }
}</code></pre>

                <div class="highlight-box">
                    <p><strong>âœ¨ ä¾èµ–æ³¨å…¥çš„é­”æ³•ï¼š</strong> è¿™é‡Œçš„å…³é”®æ˜¯æ„é€ å‡½æ•°ä¸­çš„ <code class="inline-code">constructor(private readonly catsService: CatsService)</code>ã€‚ä½ åªéœ€è¦å£°æ˜éœ€è¦ä»€ä¹ˆç±»å‹çš„ä¾èµ–ï¼ŒNestJS å°±ä¼šè‡ªåŠ¨åˆ›å»ºå®ä¾‹å¹¶æ³¨å…¥è¿›æ¥ã€‚</p>
                </div>
            </div>

            <div class="content-section" id="register-provider">
                <h2>æ³¨å†Œæä¾›è€…</h2>
                <p>å…‰å®šä¹‰æœåŠ¡è¿˜ä¸å¤Ÿï¼Œä½ è¿˜éœ€è¦å‘Šè¯‰ Nest è¿™ä¸ªæœåŠ¡çš„å­˜åœ¨ã€‚è¿™å°±éœ€è¦åœ¨æ¨¡å—ä¸­æ³¨å†Œå®ƒï¼š</p>

<pre><code class="language-typescript">// cats.module.ts
import { Module } from '@nestjs/common';
import { CatsController } from './cats.controller';
import { CatsService } from './cats.service';

@Module({
  controllers: [CatsController],
  providers: [CatsService], // åœ¨è¿™é‡Œæ³¨å†ŒæœåŠ¡
  exports: [CatsService],   // å¦‚æœå…¶ä»–æ¨¡å—éœ€è¦ä½¿ç”¨ï¼Œè®°å¾—å¯¼å‡º
})
export class CatsModule {}</code></pre>

                <p>ç„¶ååœ¨ä¸»æ¨¡å—ä¸­å¯¼å…¥è¿™ä¸ªç‰¹æ€§æ¨¡å—ï¼š</p>

<pre><code class="language-typescript">// app.module.ts
import { Module } from '@nestjs/common';
import { CatsModule } from './cats/cats.module';

@Module({
  imports: [CatsModule], // å¯¼å…¥ç‰¹æ€§æ¨¡å—
})
export class AppModule {}</code></pre>

                <div class="highlight-box">
                    <p><strong>ğŸ”„ è‡ªåŠ¨åŒ–æµç¨‹ï¼š</strong> å½“ Nest åˆå§‹åŒ– CatsController æ—¶ï¼Œå‘ç°å®ƒéœ€è¦ CatsServiceï¼Œä¾èµ–æ³¨å…¥ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æ‰¾åˆ°å·²æ³¨å†Œçš„æä¾›è€…ï¼Œå®ä¾‹åŒ–å®ƒå¹¶æ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­ã€‚</p>
                </div>
            </div>

            <div class="content-section" id="async-provider">
                <h2>å¼‚æ­¥æä¾›è€…ï¼šå¤„ç†å¤æ‚çš„åˆå§‹åŒ–</h2>
                <p>æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼šä½ çš„åº”ç”¨éœ€è¦åœ¨å¯åŠ¨æ—¶è¿æ¥æ•°æ®åº“ï¼Œåªæœ‰è¿æ¥æˆåŠŸåï¼Œå…¶ä»–æœåŠ¡æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚å¦‚æœç”¨ä¼ ç»Ÿæ–¹å¼ï¼Œä½ å¯èƒ½éœ€è¦å†™ä¸€å †å›è°ƒæˆ–è€… Promise é“¾ï¼Œä»£ç ä¼šå˜å¾—å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤ã€‚</p>
                
                <p>å¼‚æ­¥æä¾›è€…çš„è§£å†³æ–¹æ¡ˆéå¸¸ç›´è§‚ï¼Œå®ƒä½¿ç”¨ async/await é…åˆ useFactoryï¼š</p>

<pre><code class="language-typescript">import { DataSource } from 'typeorm';

// åœ¨æ¨¡å—çš„ providers ä¸­é…ç½®
{
  provide: 'DATABASE_CONNECTION',
  useFactory: async (): Promise<DataSource> => {
    const dataSource = new DataSource({
      type: 'postgres',
      host: 'localhost',
      port: 5432,
      database: 'myapp',
      // å…¶ä»–é…ç½®...
    });
    
    await dataSource.initialize();
    console.log('æ•°æ®åº“è¿æ¥å»ºç«‹æˆåŠŸï¼');
    return dataSource;
  },
}</code></pre>

                <div class="highlight-box">
                    <p><strong>â³ æ™ºèƒ½ç­‰å¾…ï¼š</strong> Nest ä¼šæ™ºèƒ½åœ°æ£€æµ‹åˆ°ä½ çš„ useFactory å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œç„¶åè€å¿ƒç­‰å¾… Promise å®Œæˆã€‚åªæœ‰å½“æ•°æ®åº“è¿æ¥çœŸæ­£å»ºç«‹åï¼Œé‚£äº›ä¾èµ–è¿™ä¸ªè¿æ¥çš„æœåŠ¡æ‰ä¼šå¼€å§‹å®ä¾‹åŒ–ã€‚</p>
                </div>

                <p>åœ¨æœåŠ¡ä¸­æ³¨å…¥ä½¿ç”¨ï¼š</p>

<pre><code class="language-typescript">import { Injectable, Inject } from '@nestjs/common';
import { DataSource } from 'typeorm';

@Injectable()
export class UserService {
  constructor(
    @Inject('DATABASE_CONNECTION') 
    private readonly dataSource: DataSource
  ) {}

  async findAllUsers() {
    const userRepository = this.dataSource.getRepository(User);
    return await userRepository.find();
  }

  async createUser(userData: CreateUserDto) {
    const userRepository = this.dataSource.getRepository(User);
    const user = userRepository.create(userData);
    return await userRepository.save(user);
  }
}</code></pre>

                <p>å¦‚æœä½ çš„å·¥å‚å‡½æ•°è¿˜éœ€è¦å…¶ä»–ä¾èµ–ï¼Œå¯ä»¥é€šè¿‡ inject å‚æ•°æ³¨å…¥ï¼š</p>

<pre><code class="language-typescript">import { Module } from '@nestjs/common';
import { ConfigModule, ConfigService } from '@nestjs/config';

@Module({
  imports: [ConfigModule],
  providers: [
    {
      provide: 'DATABASE_CONNECTION',
      useFactory: async (configService: ConfigService) => {
        // å¼‚æ­¥åˆå§‹åŒ–é€»è¾‘
      },
      inject: [ConfigService],
    },
    UserService,
  ],
  exports: ['DATABASE_CONNECTION'],
})
export class DatabaseModule {}</code></pre>
            </div>

            <div class="content-section" id="advanced">
                <h2>æä¾›è€…çš„è¿›é˜¶ç©æ³•</h2>
                
                <div id="scope">
                    <h3>ä½œç”¨åŸŸ</h3>
                    <p>NestJS ä¸­çš„æä¾›è€…é»˜è®¤é‡‡ç”¨å•ä¾‹æ¨¡å¼ï¼ˆæ•´ä¸ªåº”ç”¨å…±äº«ä¸€ä¸ªå®ä¾‹ï¼‰ï¼Œä½†å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ä½œç”¨åŸŸã€‚</p>

                    <div id="default-scope">
                        <h4>1. DEFAULTï¼ˆé»˜è®¤å•ä¾‹ï¼‰</h4>
<pre><code class="language-typescript">import { Injectable } from '@nestjs/common';

@Injectable() // ç­‰åŒäº @Injectable({ scope: Scope.DEFAULT })
export class UserService {
  private users: User[] = [];
  
  // æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…åªæœ‰ä¸€ä¸ªå®ä¾‹
  // æ‰€æœ‰æ¨¡å—å…±äº«åŒä¸€ä¸ªå®ä¾‹
  constructor() {
    console.log('UserService å®ä¾‹åˆ›å»º');
  }
}</code></pre>
                    </div>

                    <div id="request-scope">
                        <h4>2. REQUESTï¼ˆè¯·æ±‚ä½œç”¨åŸŸï¼‰</h4>
<pre><code class="language-typescript">import { Injectable, Scope } from '@nestjs/common';

@Injectable({ scope: Scope.REQUEST })
export class RequestScopedService {
  private requestData: any = {};
  
  // æ¯ä¸ª HTTP è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹
  // é€‚åˆå­˜å‚¨è¯·æ±‚ç‰¹æœ‰çš„ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€è¯·æ±‚IDç­‰ï¼‰
  constructor() {
    console.log('RequestScopedService å®ä¾‹åˆ›å»º');
  }
}</code></pre>
                    </div>

                    <div id="transient-scope">
                        <h4>3. TRANSIENTï¼ˆç¬æ€ä½œç”¨åŸŸï¼‰</h4>
<pre><code class="language-typescript">import { Injectable, Scope } from '@nestjs/common';

@Injectable({ scope: Scope.TRANSIENT })
export class TransientService {
  private instanceId = Math.random();
  
  // æ¯æ¬¡æ³¨å…¥éƒ½åˆ›å»ºæ–°å®ä¾‹
  // å®Œå…¨ç‹¬ç«‹çš„çŠ¶æ€ç®¡ç†
  constructor() {
    console.log(`TransientService å®ä¾‹åˆ›å»ºï¼ŒID: ${this.instanceId}`);
  }
}</code></pre>
                    </div>

                    <p><strong>ä½¿ç”¨åœºæ™¯å¯¹æ¯”ï¼š</strong></p>
                    <table>
                        <thead>
                            <tr>
                                <th>ä½œç”¨åŸŸ</th>
                                <th>æ€§èƒ½</th>
                                <th>å†…å­˜å ç”¨</th>
                                <th>é€‚ç”¨åœºæ™¯</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>DEFAULT</td>
                                <td>æœ€ä¼˜</td>
                                <td>æœ€ä½</td>
                                <td>æ— çŠ¶æ€æœåŠ¡ã€å·¥å…·ç±»ã€æ•°æ®åº“è¿æ¥</td>
                            </tr>
                            <tr>
                                <td>REQUEST</td>
                                <td>ä¸­ç­‰</td>
                                <td>ä¸­ç­‰</td>
                                <td>ç”¨æˆ·è®¤è¯ã€è¯·æ±‚æ—¥å¿—ã€è¯·æ±‚ä¸Šä¸‹æ–‡</td>
                            </tr>
                            <tr>
                                <td>TRANSIENT</td>
                                <td>è¾ƒå·®</td>
                                <td>è¾ƒé«˜</td>
                                <td>éœ€è¦å®Œå…¨éš”ç¦»çŠ¶æ€çš„ç‰¹æ®Šåœºæ™¯</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="optional-deps">
                    <h3>å¯é€‰ä¾èµ–</h3>
                    <p>æœ‰æ—¶æŸäº›ä¾èµ–ä¸æ˜¯å¿…éœ€çš„ï¼Œå¯ä»¥ä½¿ç”¨ <code class="inline-code">@Optional()</code> è£…é¥°å™¨ï¼š</p>

<pre><code class="language-typescript">import { Injectable, Optional } from '@nestjs/common';

@Injectable()
export class AppService {
  constructor(
    @Optional() private readonly analyticsService?: AnalyticsService
  ) {
    // analyticsService å¯èƒ½ä¸º undefined
    if (this.analyticsService) {
      this.analyticsService.track('AppService initialized');
    }
  }
  
  doSomething() {
    // ä½¿ç”¨å‰éœ€è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨
    this.analyticsService?.track('Action performed');
  }
}</code></pre>

                    <div class="highlight-box">
                        <p><strong>ğŸ”Œ æ’ä»¶åŒ–å¼€å‘ï¼š</strong> è¿™åœ¨å¼€å‘æ’ä»¶ç³»ç»Ÿæˆ–å¯é€‰åŠŸèƒ½æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
                    </div>
                </div>

                <div id="property-injection">
                    <h3>å±æ€§æ³¨å…¥</h3>
                    <p>é™¤äº†æ„é€ å‡½æ•°æ³¨å…¥ï¼ŒNest ä¹Ÿæ”¯æŒå±æ€§æ³¨å…¥ï¼š</p>

<pre><code class="language-typescript">import { Injectable, Inject } from '@nestjs/common';

@Injectable()
export class CatsService {
  @Inject(ConfigService)
  private readonly configService: ConfigService;
  
  getSettings() {
    return this.configService.get('cats');
  }
}</code></pre>

                    <div class="warning-box">
                        <p><strong>âš ï¸ æ¨èå»ºè®®ï¼š</strong> ä¸è¿‡ï¼Œé€šå¸¸è¿˜æ˜¯æ¨èç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œå› ä¸ºä¾èµ–å…³ç³»æ›´æ¸…æ™°ï¼Œä¹Ÿæ›´ä¾¿äºæµ‹è¯•ã€‚</p>
                    </div>
                </div>

                <div id="manual-instance">
                    <h3>æ‰‹åŠ¨è·å–å®ä¾‹</h3>
                    <p>æœ‰æ—¶éœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€è·å–æä¾›è€…å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ ModuleRefï¼š</p>

<pre><code class="language-typescript">import { Injectable, ModuleRef } from '@nestjs/core';
import { UserService } from '../user/user.service';
import { LoggerService } from '../logger/logger.service';

@Injectable()
export class DynamicService {
  constructor(private moduleRef: ModuleRef) {}

  async getUserData(userId: string) {
    // åŠ¨æ€è·å–ç”¨æˆ·æœåŠ¡
    const userService = this.moduleRef.get(UserService);
    
    // è·å–è¯·æ±‚èŒƒå›´çš„æ—¥å¿—æœåŠ¡ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯æ–°å®ä¾‹ï¼‰
    const logger = await this.moduleRef.resolve(LoggerService);
    
    logger.log(`Getting user data for ${userId}`);
    return userService.findById(userId);
  }

  async getServiceByName(serviceName: string) {
    try {
      // æ ¹æ®å­—ç¬¦ä¸² token åŠ¨æ€è·å–æœåŠ¡
      const service = this.moduleRef.get(serviceName, { strict: false });
      return service;
    } catch (error) {
      console.log(`Service ${serviceName} not found`);
      return null;
    }
  }
}</code></pre>
                </div>

                <div id="custom-providers">
                    <h3>è‡ªå®šä¹‰æä¾›è€…</h3>
                    <p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æä¾›è€…éƒ½æ˜¯åŸºäºç±»çš„ã€‚ä½† Nest çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿéå¸¸çµæ´»ï¼Œå®ƒä¸ä»…æ”¯æŒæä¾›ç±»ä½œä¸º Providerï¼Œè¿˜å¯ä»¥æä¾›ï¼š</p>
                    
                    <ul>
                        <li><strong>æ™®é€šå€¼ (Value Providers)</strong>ï¼šä½¿ç”¨ <code class="inline-code">useValue</code> æä¾›å¸¸é‡ã€é…ç½®å¯¹è±¡ç­‰ã€‚</li>
                        <li><strong>ç±» (Class Providers)</strong>ï¼šä½¿ç”¨ <code class="inline-code">useClass</code> æä¾›ä¸€ä¸ªç±»çš„å®ä¾‹ï¼ˆæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é»˜è®¤æ–¹å¼ï¼‰ã€‚</li>
                        <li><strong>å·¥å‚å‡½æ•° (Factory Providers)</strong>ï¼šä½¿ç”¨ <code class="inline-code">useFactory</code> æ ¹æ®åŠ¨æ€é€»è¾‘ï¼ˆå¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥ï¼‰åˆ›å»ºå’Œæä¾›å®ä¾‹ï¼ˆå¦‚ä¹‹å‰çš„æ•°æ®åº“è¿æ¥ç¤ºä¾‹ï¼‰ã€‚</li>
                        <li><strong>åˆ«å (Alias Providers)</strong>ï¼šä½¿ç”¨ <code class="inline-code">useExisting</code> ä¸ºå·²å­˜åœ¨çš„æä¾›è€…åˆ›å»ºä¸€ä¸ªåˆ«åæˆ–ä¸åŒçš„ tokenã€‚</li>
                    </ul>

                    <div class="highlight-box">
                        <p><strong>ğŸ¯ çµæ´»æ€§ï¼š</strong> è¿™ç§çµæ´»æ€§ä½¿å¾—ä½ å¯ä»¥ç”¨éå¸¸ç²¾ç»†çš„æ–¹å¼æ¥ç®¡ç†å’Œæä¾›åº”ç”¨ç¨‹åºä¸­çš„å„ç§ä¾èµ–ã€‚æˆ‘ä»¬åé¢ä¼šå•ç‹¬ä»‹ç»ä¸‹å„ç§è‡ªå®šä¹‰æä¾›è€…çš„å…·ä½“ä½¿ç”¨æ–¹å¼å’Œåœºæ™¯ã€‚</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="scroll-top" onclick="scrollToTop()">
        â†‘
    </div>

    <script>
        // å¹³æ»‘æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // æ˜¾ç¤º/éšè—å›åˆ°é¡¶éƒ¨æŒ‰é’®
        window.addEventListener('scroll', function() {
            const scrollTop = document.querySelector('.scroll-top');
            if (window.pageYOffset > 300) {
                scrollTop.classList.add('visible');
            } else {
                scrollTop.classList.remove('visible');
            }
        });

        // ä¾§è¾¹æ å¯¼èˆªé«˜äº®
        const sections = document.querySelectorAll('.content-section[id]');
        const navLinks = document.querySelectorAll('.sidebar a[href^="#"]');

        function updateActiveNav() {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.style.background = '';
                link.style.color = '';
                if (link.getAttribute('href') === '#' + current) {
                    link.style.background = '#4a5568';
                    link.style.color = '#63b3ed';
                }
            });
        }

        window.addEventListener('scroll', updateActiveNav);
        updateActiveNav();

        // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                      behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // ä»£ç å—å¤åˆ¶åŠŸèƒ½
        document.querySelectorAll('pre code').forEach((block) => {
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'å¤åˆ¶';
            button.style.cssText = `
                position: absolute;
                top: 10px;
                right: 10px;
                background: #4a5568;
                color: white;
                border: none;
                padding: 5px 10px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
                opacity: 0;
                transition: opacity 0.3s;
            `;
            
            const pre = block.parentElement;
            pre.style.position = 'relative';
            pre.appendChild(button);
            
            pre.addEventListener('mouseenter', () => {
                button.style.opacity = '1';
            });
            
            pre.addEventListener('mouseleave', () => {
                button.style.opacity = '0';
            });
            
            button.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(block.textContent);
                    button.textContent = 'å·²å¤åˆ¶!';
                    button.style.background = '#38a169';
                    setTimeout(() => {
                        button.textContent = 'å¤åˆ¶';
                        button.style.background = '#4a5568';
                    }, 2000);
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                }
            });
        });

        // æ·»åŠ åŠ è½½åŠ¨ç”»
        window.addEventListener('load', function() {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        });

        // å“åº”å¼ä¾§è¾¹æ 
        function createMobileMenu() {
            if (window.innerWidth <= 768) {
                const sidebar = document.querySelector('.sidebar');
                const mainContent = document.querySelector('.main-content');
                
                // åˆ›å»ºç§»åŠ¨ç«¯èœå•æŒ‰é’®
                if (!document.querySelector('.mobile-menu-btn')) {
                    const menuBtn = document.createElement('button');
                    menuBtn.className = 'mobile-menu-btn';
                    menuBtn.innerHTML = 'â˜°';
                    menuBtn.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 20px;
                        z-index: 1001;
                        background: #2d3748;
                        color: white;
                        border: none;
                        padding: 10px 15px;
                        border-radius: 5px;
                        font-size: 18px;
                        cursor: pointer;
                    `;
                    
                    document.body.appendChild(menuBtn);
                    
                    menuBtn.addEventListener('click', () => {
                        if (sidebar.style.transform === 'translateX(0px)') {
                            sidebar.style.transform = 'translateX(-100%)';
                        } else {
                            sidebar.style.transform = 'translateX(0px)';
                        }
                    });
                    
                    // ç‚¹å‡»ä¸»å†…å®¹åŒºåŸŸå…³é—­ä¾§è¾¹æ 
                    mainContent.addEventListener('click', () => {
                        if (window.innerWidth <= 768) {
                            sidebar.style.transform = 'translateX(-100%)';
                        }
                    });
                }
            }
        }

        window.addEventListener('resize', createMobileMenu);
        createMobileMenu();

        // æ·»åŠ æ‰“å°æ ·å¼
        const printStyles = `
            @media print {
                .sidebar, .scroll-top, .copy-button, .mobile-menu-btn {
                    display: none !important;
                }
                .main-content {
                    margin-left: 0 !important;
                    max-width: 100% !important;
                }
                .content-section {
                    box-shadow: none !important;
                    border: 1px solid #ddd !important;
                    page-break-inside: avoid;
                }
                pre {
                    page-break-inside: avoid;
                    background: #f5f5f5 !important;
                    color: #333 !important;
                }
            }
        `;
        
        const styleSheet = document.createElement('style');
        styleSheet.textContent = printStyles;
        document.head.appendChild(styleSheet);
    </script>
</body>
</html>
